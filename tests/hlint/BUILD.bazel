load(
    "@io_tweag_rules_haskell//haskell:haskell.bzl",
    "haskell_library",
)
load(
    "@io_tweag_rules_haskell//haskell:lint.bzl",
    "haskell_lint_test",
)

haskell_library(
    name = "good",
    srcs = ["Good.hs"],
    deps = [
        ":bad-indirect",
        "//tests/hackage:base",
    ],
)

haskell_lint_test(
    name = "good-hlint",
    experimental_lint_blacklist = [":bad-indirect"],
    tags = ["requires_hlint"],
    deps = [
        ":good",
    ],
)

haskell_library(
    name = "bad-indirect",
    srcs = ["BadIndirect.hs"],
    deps = [
        "//tests/hackage:base",
    ],
)

haskell_library(
    name = "bad",
    srcs = ["Bad.hs"],
    deps = [
        ":bad-indirect",
        "//tests/hackage:base",
    ],
)

# See //tests/failures:haskell_hlint_bad_hlint
haskell_lint_test(
    name = "bad-hlint",
    tags = [
        "manual",  # must FAIL
        "requires_hlint",
    ],
    visibility = ["//tests/failures:__pkg__"],
    deps = [
        ":bad",
    ],
)
